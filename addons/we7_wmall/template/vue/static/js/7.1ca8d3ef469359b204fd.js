webpackJsonp([7],{kYuw:function(t,a,o){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=o("woOf"),e=o.n(i),d=o("Gu7T"),s=o.n(d),n=o("mvHQ"),r=o.n(n),l=o("Dd8w"),h=o.n(l),g=o("NYxO"),c=o("Cz8s"),y=o("mzkE"),u=o("fgl9"),f=o("kEnp"),p=o("qBcp"),m={name:"diyIndex",data:function(){return{title:"",id:0,getLocationFail:!1,showPreLoading:!0,styleContent:"#fff",diydata:{diy:{data:{}},storeExtra:{condition:{order:"",mode:"",dis:""},filter_title:"综合排序",multiple:!1,filter:!1},stores:{loading:!0,finished:!1,page:1,psize:20,loaded:0,empty:0,data:[],filter:{cid:0,child_id:0,categorySelectedId:0}},hotGoods:{loading:!0,finished:!1,page:1,psize:20,loaded:0,empty:0,data:[],filter:{sailed_month:0,is_hot:0,comment_good_percent:0}},showStoreOrGoods:"store",popup:{storeSearch:!1,haodianSearch:!1,serviceQrcode:!1},superRedpacketData:{},guideData:{is_show:!1},tongcheng:{get_all:0,page:2,psize:10,loading:!0,loaded:!1,finished:!1,empty:!1,data:[]},haodian:{page:2,psize:15,loading:!1,loaded:!1,finished:!1,empty:!1,data:[]},haodianExtra:{orderby:"distance",haodian_cid:0,haodian_child_id:0,cIndexActive:0},haodianCategory:[],showSearchSign:!1},showFixedSearchBar:!1,goodsTabActive:0,goodsTabFixed:0,goodsTabHeights:[],goodsTabOffsetTop:0,storesTabActive:0,storesTabActiveReal:0,storesTabFixed:0,storesTabHeights:[],storesTabOffsetTop:0,followHeight:0,scrollFromClickTab:!1,menufooter:{},follow:{},followShow:!1,userAgreement:""}},components:{PublicHeader:c.a,PublicFooter:y.a,diy:f.a,follow:u.a,userAgreement:p.a},watch:{$route:function(){this.id=this.$route.query.id},id:function(){this.onInit()}},methods:h()({},Object(g.b)(["setLocation","getLocation","setState"]),{onToggleShowStoreOrGoods:function(t){this.diydata.showStoreOrGoods=t},onToggleHotGoodsFilter:function(t){this.diydata.hotGoods.filter[t]=!this.diydata.hotGoods.filter[t],this.onGetHotGoods(!0)},onGetHotGoods:function(t){var a=this,o=this;t&&(o.diydata.hotGoods={page:1,psize:20,loaded:0,empty:!1,loading:!0,finished:!1,filter:o.diydata.hotGoods.filter}),o.diydata.hotGoods.loading=!0,this.util.request({url:"wmall/home/index/hotGoods",data:{lat:o.locationInfo.location_x,lng:o.locationInfo.location_y,page:o.diydata.hotGoods.page,psize:o.diydata.hotGoods.psize,filter:r()(o.diydata.hotGoods.filter)}}).then(function(i){var e=i.data.message.message;t&&(o.diydata.hotGoods.data=[]),o.diydata.hotGoods.data=[].concat(s()(a.diydata.hotGoods.data),s()(e.goods)),e.pagetotal<=o.diydata.hotGoods.page&&(o.diydata.hotGoods.loaded=1,o.diydata.hotGoods.data.length||(o.diydata.hotGoods.empty=!0),o.diydata.hotGoods.finished=!0),o.diydata.hotGoods.loading=!1,o.diydata.hotGoods.page++})},onInit:function(){var t=this;this.getLocation(),this.locationInfo.location_x?(t.getLocationFail=!1,t.locationInfo.last_location_x=this.locationInfo.location_x,t.onLoad()):this.util.getLocation({successLocation:function(a){t.setLocation({location_x:a.location_x,location_y:a.location_y}),t.onLoad()},successAddress:function(a){t.setLocation({location_x:a.location_x,location_y:a.location_y,address:a.address})},fail:function(a){t.setLocation({last_location_x:0,location_x:0,address:"获取定位失败"}),t.getLocationFail=!0,t.onLoad()}})},onChangeStoreCategory:function(t){if(1!=this.diy.is_has_allstore||!t.id||t.id==this.diydata.stores.filter.categorySelectedId)return!1;this.diydata.stores.filter.child_id=t.parentid>0?t.id:0,this.diydata.stores.filter.categorySelectedId=t.id,this.onGetStore(!0)},onToggleDiscount:function(t,a){"waimai_stores"==this.diydata.diy.data.items[a].id?this.diydata.diy.data.items[a].data[t].activity.is_show_all=!this.diydata.diy.data.items[a].data[t].activity.is_show_all:this.diydata.stores.data[t].activity.is_show_all=!this.diydata.stores.data[t].activity.is_show_all,this.diydata=e()({},this.diydata)},onToggleStoresTabDiscount:function(t,a,o){this.diydata.diy.data.items[o].data[t].stores[a].activity.is_show_all=!this.diydata.diy.data.items[o].data[t].stores[a].activity.is_show_all},onCloseRedpacket:function(){this.diydata.superRedpacketData.is_show=!1,this.diydata.superRedpacketData=e()({},this.diydata.superRedpacketData)},onChangeStoreExtra:function(t){"multiple"==t?(this.diydata.storeExtra.multiple=!0,this.diydata.storeExtra.filter=!1):(this.diydata.storeExtra.multiple=!1,this.diydata.storeExtra.filter=!0),this.diydata.popup.storeSearch=!0},onStoreOrderby:function(t,a,o){if("order"==t)"svipRedpacket"==a?this.diydata.storeExtra.condition.dis=a:(this.diydata.storeExtra.condition.order=a,this.diydata.storeExtra.multiple=!1,this.diydata.storeExtra.filter_title="sailed"!=a&&"distance"!=a?o:"综合排序");else if("discounts"==t){if(this.diydata.storeExtra.condition.dis==a&&(a=""),this.diydata.storeExtra.condition.dis=a,"refresh"!=o)return!1}else{if("mode"==t)return this.diydata.storeExtra.condition.mode==a&&(a=""),this.diydata.storeExtra.condition.mode=a,!1;"clear"==t?(this.diydata.storeExtra.condition.dis="",this.diydata.storeExtra.condition.order="",this.diydata.storeExtra.condition.mode="",this.diydata.storeExtra.filter=!1,this.diydata.storeExtra.filter_title="综合排序"):"finish"==t&&(this.diydata.storeExtra.filter=!1)}this.diydata.popup.storeSearch=!1,this.onGetStore(!0)},onGetStore:function(t){var a=this,o=this;t&&(o.diydata.stores={page:1,psize:20,loaded:0,empty:!1,loading:!0,filter:o.diydata.stores.filter}),o.diydata.stores.loading=!0,this.util.request({url:"wmall/home/index/store",data:{lat:o.locationInfo.location_x,lng:o.locationInfo.location_y,page:o.diydata.stores.page,psize:o.diydata.stores.psize,cid:o.diydata.stores.filter.cid,child_id:o.diydata.stores.filter.child_id,condition:r()(o.diydata.storeExtra.condition)}}).then(function(i){var e=i.data.message.message;t&&(o.diydata.stores.data=[]),o.diydata.stores.data=[].concat(s()(a.diydata.stores.data),s()(e.stores)),e.pagetotal<=o.diydata.stores.page&&(o.diydata.stores.loaded=1,o.diydata.stores.data.length||(o.diydata.stores.empty=!0),o.diydata.stores.finished=!0),o.diydata.stores.loading=!1,o.diydata.stores.page++,o.diydata.stores.loaded||e.stores.length||a.onGetStore()})},onGetInformation:function(t){var a=this,o=this;t&&(o.diydata.tongcheng={page:1,psize:10,loaded:0,empty:!1,loading:!0,data:[]}),o.diydata.tongcheng.loading=!0,this.util.request({url:"diypage/diy/information",data:{page:o.diydata.tongcheng.page,psize:o.diydata.tongcheng.psize}}).then(function(t){var i=t.data.message.message;o.diydata.tongcheng.data=[].concat(s()(a.diydata.tongcheng.data),s()(i.informations)),i.informations.length<o.diydata.tongcheng.psize&&(o.diydata.tongcheng.loaded=1,o.diydata.tongcheng.data.length||(o.diydata.tongcheng.empty=!0),o.diydata.tongcheng.finished=!0),o.diydata.tongcheng.loading=!1,o.diydata.tongcheng.page++})},onLoad:function(){var t=this;this.util.request({url:"diypage/diy",data:{lat:this.locationInfo.location_x,lng:this.locationInfo.location_y,id:this.id,menufooter:1}}).then(function(a){var o=t;o.showPreLoading=!1;var i=a.data.message;if(i.errno)o.util.$toast(i.message);else{if(o.diydata.config=i.message.config,o.diydata.diy=i.message.diy,o.diy=i.message.diy,o.diydata.diy.guide)if(1==o.diydata.diy.guide.params.status&&"interval"==o.diydata.diy.guide.params.show_setting){var e=t.util.getStorage("guideStorage");(!e||e&&!e.show)&&(t.util.setStorage("guideStorage",{show:1},60*o.diydata.diy.guide.params.interval_time),o.diydata.guideData.is_show=!0)}else 1==o.diydata.diy.guide.params.status&&"everytime"==o.diydata.diy.guide.params.show_setting&&(t.util.removeStorage("guideStorage"),o.diydata.guideData.is_show=!0);var d=i.message.default_location;if(d&&d.location_x&&(t.getLocationFail=!1,o.setLocation(d)),o.diydata.diy.tongcheng&&(o.diydata.tongcheng.data=[].concat(s()(o.diydata.diy.tongcheng.informationdata)),0==o.diydata.tongcheng.data.length&&(o.diydata.tongcheng.empty=!0),o.diydata.tongcheng.loading=!1,o.diydata.tongcheng.has_get_all=o.diydata.diy.tongcheng.has_get_all,delete o.diydata.diy.tongcheng,1==o.diydata.tongcheng.has_get_all&&(o.diydata.tongcheng.finished=!0,o.diydata.tongcheng.loaded=!0)),o.diydata.diy.haodian&&(o.diydata.haodianCategory=[].concat(s()(o.diydata.diy.haodian.category)),o.diydata.haodianExtra.haodian_child_id=o.diydata.diy.haodian.haodian_child_id,o.diydata.haodian.data=[].concat(s()(o.diydata.diy.haodian.store)),o.diydata.haodian.loading=!1,(!o.diydata.diy.haodian.store||o.diydata.diy.haodian.store.length<o.diydata.haodian.psize)&&(o.diydata.haodian.loaded=!0),o.diydata.haodian.data.length||(o.diydata.haodian.empty=!0)),o.title=i.message.diy.data.page.title,o.util.setWXTitle(o.title),o.diydata.superRedpacketData=i.message.superRedpacketData,o.diydata.superRedpacketData.is_show=!0,o.diydata.cart_sum=i.message.cart_sum,o.userAgreement=i.message.userAgreement,o.menufooter=window.menufooter,o.follow=window.follow,1==o.diy.data.page.followbar&&o.follow&&1==o.follow.status&&(o.followShow=!0),o.styleContent={"background-color":t.diydata.diy.data.page.background},1==o.diy.is_show_kefu&&o.util.imeiqia(),1==o.diy.is_has_allstore){if(o.diydata.stores.loaded=!1,o.diydata.stores.finished=!1,o.diydata.stores.empty=!1,o.diydata.stores.page=1,o.diydata.stores.filter.cid=o.diy.cid,o.diydata.stores.filter.categorySelectedId=o.diy.cid,(1==t.util.getStorage("istamp")||1==t.util.getStorage("jskey"))&&i.message.stores.stores.length>5){var n=Math.floor(5*Math.random());i.message.stores.stores=i.message.stores.stores.slice(2,n)}o.diydata.stores.data=[].concat(s()(i.message.stores.stores)),i.message.stores.pagetotal<=o.diydata.stores.page&&(o.diydata.stores.loaded=1,o.diydata.stores.data.length||(o.diydata.stores.empty=!0),o.diydata.stores.finished=!0),o.diydata.stores.loading=!1,o.diydata.stores.page++,o.diydata.stores.loaded||i.message.stores.stores.length||o.onGetStore()}1==o.diydata.diy.is_has_hotGoods&&(o.diydata.hotGoods.data=[].concat(s()(t.diydata.hotGoods.data),s()(i.message.hotGoods.goods)),i.message.hotGoods.pagetotal<=o.diydata.hotGoods.page&&(o.diydata.hotGoods.loaded=1,o.diydata.hotGoods.data.length||(o.diydata.hotGoods.empty=!0),o.diydata.hotGoods.finished=!0),o.diydata.hotGoods.loading=!1,o.diydata.hotGoods.page++,1!=o.diydata.diy.is_has_allstore&&(o.diydata.showStoreOrGoods="goods")),1==o.diy.is_has_goodsTab&&t.$nextTick(function(){t.onCalculateGoodsTabItemHeight()}),1==o.diy.is_has_storesTab&&t.$nextTick(function(){t.onCalculateStoresTabItemHeight()})}})},onGetCartNums:function(){var t=this;this.util.request({url:"wmall/home/index/cart"}).then(function(a){var o=a.data.message;o.errno?t.util.$toast(o.message):t.diydata.cart_sum=o.message.cart_sum})},onCloseGuide:function(){this.diydata.guideData.is_show=!1},onToggleInformation:function(t){this.diydata.tongcheng.data[t].showall=!this.diydata.tongcheng.data[t].showall},onGetHaodianStore:function(t){var a=this;t&&(a.diydata.haodian={page:1,psize:10,loaded:!1,empty:!1,loading:!0,data:[]}),this.util.request({url:"haodian/index/store",data:{lat:a.locationInfo.location_x,lng:a.locationInfo.location_y,page:a.diydata.haodian.page,psize:a.diydata.haodian.psize,orderby:a.diydata.haodianExtra.orderby,haodian_cid:a.diydata.haodianExtra.haodian_cid,haodian_child_id:a.diydata.haodianExtra.haodian_child_id}}).then(function(t){var o=t.data.message.message;a.diydata.haodian.data=[].concat(s()(a.diydata.haodian.data),s()(o.store)),o.store.length<a.diydata.haodian.psize&&(a.diydata.haodian.loaded=!0),a.diydata.haodian.data.length||(a.diydata.haodian.empty=!0),a.diydata.haodian.loading=!1,a.diydata.haodian.page++})},onChangeHaodianExtra:function(t){if("filter"==t)this.diydata.popup.haodianSearch=!this.diydata.popup.haodianSearch;else{if(t==this.diydata.haodianExtra.orderby)return;this.diydata.showSearchSign=!1,this.diydata.haodianExtra.orderby=t,this.diydata.haodianExtra.haodian_cid=0,this.diydata.haodianCategory.length>0&&this.diydata.haodianCategory[0].children.length>0&&(this.diydata.haodianExtra.haodian_child_id=this.diydata.haodianCategory[0].children[0].id),this.diydata.haodianExtra.cIndexActive=0,this.onGetHaodianStore(!0)}},onClickHaodianParentCategory:function(t){this.diydata.haodianExtra.cIndexActive=t,this.diydata.haodianCategory.hasOwnProperty(t)&&(this.diydata.haodianExtra.haodian_cid=this.diydata.haodianCategory[t].id,this.diydata.haodianCategory[t].children.length>0&&(this.diydata.haodianExtra.haodian_child_id=this.diydata.haodianCategory[t].children[0].id))},onClickHaodianChildCategory:function(t){t&&(this.diydata.haodianExtra.haodian_child_id=t.id,0==this.diydata.haodianExtra.haodian_cid&&this.diydata.haodianCategory.length>0&&(this.diydata.haodianExtra.haodian_cid=this.diydata.haodianCategory[0].id))},onHaodianCategoryConfirm:function(){this.diydata.haodianExtra.haodian_child_id>0&&0==this.diydata.haodianExtra.haodian_cid&&this.diydata.haodianCategory.length>0&&(this.diydata.haodianExtra.haodian_cid=this.diydata.haodianCategory[0].id),this.diydata.showSearchSign=!0,this.onGetHaodianStore(!0),this.onChangeHaodianExtra("filter")},onToggleService:function(){this.diydata.popup.serviceQrcode=!this.diydata.popup.serviceQrcode},onChangeFollowStatus:function(t){t.status||(this.followHeight=0)},onCalculateGoodsTabItemHeight:function(){this.goodsTabOffsetTop=document.getElementsByClassName("goods-tab-inner")[0].offsetTop,this.goodsTabOffsetTop-=document.getElementsByClassName("van-tabs")[0].clientHeight-44,document.getElementById("follow")&&(this.followHeight=document.getElementsByClassName("follow-tips")[0].clientHeight,this.goodsTabOffsetTop-=this.followHeight);for(var t=document.getElementsByClassName("goods-tab-item"),a=this.goodsTabOffsetTop,o=[],i=0;i<t.length;i++){a+=t[i].clientHeight,o.push(a)}this.goodsTabHeights=o},onToggleGoodsTab:function(t){this.scrollFromClickTab=!0;var a=this.goodsTabOffsetTop-44;t.index>=1&&(a=this.goodsTabHeights[t.index-1]-44),a-=this.followHeight,this.diydata.diy.is_has_location&&a>100?(this.goodsTabFixed=2,a-=52):this.util.isWeixin()?this.goodsTabFixed=1:(this.goodsTabFixed=3,a-=46),window.scrollTo(0,a),this.goodsTabActive=t.index},onCalculateStoresTabItemHeight:function(){this.storesTabOffsetTop=document.getElementsByClassName("stores-tab-group")[0].offsetTop,this.storesTabOffsetTop-=document.getElementById("stores-tab").clientHeight-44,document.getElementById("follow")&&(this.followHeight=document.getElementsByClassName("follow-tips")[0].clientHeight,this.storesTabOffsetTop-=this.followHeight);for(var t=document.getElementsByClassName("stores-tab-list"),a=this.storesTabOffsetTop,o=[],i=0;i<t.length;i++){a+=t[i].clientHeight,o.push(a)}this.storesTabHeights=o},onToggleStoresTab:function(t){this.scrollFromClickTab=!0;var a=this.storesTabOffsetTop-44;t.index>=1&&(a=this.storesTabHeights[t.index-1]-44),a-=this.followHeight,this.diydata.diy.is_has_location&&a>100?(this.storesTabFixed=2,a-=52):this.util.isWeixin()?this.storesTabFixed=1:(this.storesTabFixed=3,a-=46),window.scrollTo(0,a),this.storesTabActive=t.index}}),created:function(){this.$route.query.id?this.id=this.$route.query.id:this.util.$toast("页面不存在！")},computed:h()({},Object(g.c)(["locationInfo"])),activated:function(){if(this.locationInfo.last_location_x!=this.locationInfo.location_x)return this.diydata.storeExtra={condition:{order:"",mode:"",dis:""},filter_title:"综合排序",multiple:!1,filter:!1},void this.onInit();this.onGetCartNums()},mounted:function(){var t=this;window.addEventListener("scroll",function(){var a=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(t.showFixedSearchBar=a>100,1==t.diy.is_has_goodsTab){var o=44;if(t.util.isWeixin()||(o=90),t.diydata.diy.is_has_location&&t.showFixedSearchBar&&(o=96),(a=Math.ceil(a+o))>=t.goodsTabOffsetTop?t.diydata.diy.is_has_location&&t.showFixedSearchBar?t.goodsTabFixed=2:t.util.isWeixin()?t.goodsTabFixed=1:t.goodsTabFixed=3:t.goodsTabFixed=0,!t.scrollFromClickTab)for(var i=t.goodsTabHeights,e=i.length,d=0;d<e;d++){if(!i[d+1]){t.goodsTabActive=d;break}if(a<i[d]){t.goodsTabActive=d;break}if(a>=i[d]&&a<i[d+1]){t.goodsTabActive=d+1;break}}}if(1==t.diy.is_has_storesTab){o=44;if(t.util.isWeixin()||(o=90),t.diydata.diy.is_has_location&&t.showFixedSearchBar&&(o=96),(a=Math.ceil(a+o))>=t.storesTabOffsetTop?t.diydata.diy.is_has_location&&t.showFixedSearchBar?t.storesTabFixed=2:t.util.isWeixin()?t.storesTabFixed=1:t.storesTabFixed=3:t.storesTabFixed=0,!t.scrollFromClickTab){var s=t.storesTabHeights;for(e=s.length,d=0;d<e;d++){if(!s[d+1]){t.storesTabActive=d;break}if(a<s[d]){t.storesTabActive=d;break}if(a>=s[d]&&a<s[d+1]){t.storesTabActive=d+1;break}}}}t.scrollFromClickTab=!1})}},_={render:function(){var t=this,a=t.$createElement,o=t._self._c||a;return o("div",{attrs:{id:"diy"}},[(t.util.isGlala()||t.util.ish5app())&&!t.util.getStorage("userAgreement")&&t.userAgreement?o("user-agreement",{attrs:{agreement:t.userAgreement}}):t._e(),t._v(" "),t.followShow?o("follow",{attrs:{follow:t.follow},on:{changeStatus:t.onChangeFollowStatus}}):t._e(),t._v(" "),t.isWeixin?t._e():o("public-header",{attrs:{title:t.title}}),t._v(" "),t.menufooter?o("public-footer",{attrs:{menufooter:t.menufooter}}):t._e(),t._v(" "),o("div",{staticClass:"container",style:t.styleContent},[o("diy",{attrs:{diydata:t.diydata,preLoading:t.showPreLoading,getLocationFail:t.getLocationFail,showFixedSearchBar:t.showFixedSearchBar,goodsTabActive:t.goodsTabActive,goodsTabFixed:t.goodsTabFixed,storesTabActive:t.storesTabActive,storesTabFixed:t.storesTabFixed},on:{onToggleDiscount:t.onToggleDiscount,onToggleStoresTabDiscount:t.onToggleStoresTabDiscount,onChangeStoreExtra:t.onChangeStoreExtra,onStoreOrderby:t.onStoreOrderby,onGetStore:t.onGetStore,onCloseRedpacket:t.onCloseRedpacket,onCloseGuide:t.onCloseGuide,onGetInformation:t.onGetInformation,onToggleInformation:t.onToggleInformation,onGetHaodianStore:t.onGetHaodianStore,onChangeHaodianExtra:t.onChangeHaodianExtra,onClickHaodianParentCategory:t.onClickHaodianParentCategory,onClickHaodianChildCategory:t.onClickHaodianChildCategory,onHaodianCategoryConfirm:t.onHaodianCategoryConfirm,onToggleService:t.onToggleService,onToggleGoodsTab:t.onToggleGoodsTab,onToggleStoresTab:t.onToggleStoresTab,onChangeStoreCategory:t.onChangeStoreCategory,onToggleShowStoreOrGoods:t.onToggleShowStoreOrGoods,onToggleHotGoodsFilter:t.onToggleHotGoodsFilter,onGetHotGoods:t.onGetHotGoods}})],1)],1)},staticRenderFns:[]};var T=o("VU/8")(m,_,!1,function(t){o("twJC")},null,null);a.default=T.exports},qBcp:function(t,a,o){"use strict";var i={render:function(){var t=this,a=t.$createElement,o=t._self._c||a;return o("div",{attrs:{id:"user-agreement"}},[o("van-popup",{model:{value:t.popupStatus,callback:function(a){t.popupStatus=a},expression:"popupStatus"}},[o("div",{staticClass:"popup-title van-hairline--bottom"},[o("span",{staticClass:"font-bold"},[t._v("用户服务协议和隐私政策概要")]),t._v(" "),t._e()]),t._v(" "),o("div",{staticClass:"popup-content",domProps:{innerHTML:t._s(t.agreement)}}),t._v(" "),o("ul",{staticClass:"popup-footer flex-lr font-15 van-hairline--top"},[o("li",{staticClass:"c-gray van-hairline--right",on:{click:t.onCancel}},[t._v("暂不使用")]),t._v(" "),o("li",{staticClass:"c-danger",on:{click:t.onConfirm}},[t._v("同意")])])])],1)},staticRenderFns:[]};var e=o("VU/8")({props:{agreement:""},data:function(){return{popupStatus:!0}},methods:{onTogglePopupStatus:function(){this.popupStatus=!this.popupStatus},onCancel:function(){this.util.closeApp(),this.onTogglePopupStatus()},onConfirm:function(){this.util.setStorage("userAgreement",1),this.onTogglePopupStatus()}}},i,!1,function(t){o("wHI3")},null,null);a.a=e.exports},twJC:function(t,a){},wHI3:function(t,a){}});
//# sourceMappingURL=7.1ca8d3ef469359b204fd.js.map