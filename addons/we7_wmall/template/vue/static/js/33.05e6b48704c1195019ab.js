webpackJsonp([33],{aUzT:function(t,s,o){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=o("Gu7T"),n=o.n(i),a=o("Cz8s"),e=o("NPH5"),c={data:function(){return{store:{},tables:[],table_sn:"",note:"",status:{noDiscountShow:!1,couponShow:!1,tableShow:!1},payment:[],pay_type:"wechat",couponNum:0,coupons:[],couponId:0,condition:0,discount_fee:0,total:0,nodiscount:0,paybill_extra:"",showPreLoading:!0}},components:{PublicHeader:a.a,load:e.a},computed:{final:function(){var t=parseFloat(this.total-this.discount_fee);return(!t||t<0)&&(t=0),t},couponTitle:function(){var t="未使用";return this.couponId&&(t=this.discount_fee+this.Lang.dollarSignCn+"券"),t}},watch:{nodiscount:function(){this.onCalculate(),this.onGetCoupon()},discount_fee:function(){this.onCalculate()},total:function(){this.onGetCoupon(),this.onCalculate()}},methods:{onInput:function(t){var s=t.target.dataset.type;"total"==s?this.total=t.target.value:"nodiscount"==s&&(this.nodiscount=t.target.value)},onToggleStatus:function(t){this.status[t]=!this.status[t],"noDiscountShow"!=t||this.status.noDiscountShow||(this.nodiscount=0)},onLoad:function(){var t=this;this.util.request({url:"wmall/store/paybill/payment",data:{sid:this.sid}}).then(function(s){t.showPreLoading=!1;var o=s.data.message;if(o.errno)return t.util.$toast(o.message),!1;o=o.message,t.store=o.store,t.payment=o.payment,t.tables=[].concat(n()(t.tables),n()(o.tables)),t.paybill_extra=o.paybill_extra,t.util.setWXTitle(t.store.title)})},onCalculate:function(){this.total=parseFloat(this.total),this.discount_fee=parseFloat(this.discount_fee),this.nodiscount=parseFloat(this.nodiscount),this.canDiscount=this.total-this.nodiscount,this.couponId>0&&this.canDiscount<this.condition&&(this.couponId=0,this.condition=0,this.discount_fee=0),this.nodiscount>0&&this.nodiscount>this.total&&this.$toast("超出消费总额,重新输入")},onGetCoupon:function(){var t=this;this.canDiscount=this.total-this.nodiscount,this.util.request({url:"wmall/store/paybill/coupon",data:{sid:this.sid,sum:this.canDiscount}}).then(function(s){var o=s.data.message;t.couponNum=o.num,t.coupons=[].concat(n()(o.message))})},onSelectCoupon:function(t,s){this.canDiscount=this.total-this.nodiscount,this.couponId=s,s>0&&this.coupons[t].id==s?this.canDiscount>=this.coupons[t].condition&&(this.discount_fee=this.coupons[t].discount,this.condition=this.coupons[t].condition):this.discount_fee=0,this.status.couponShow=!1},onTableConfirm:function(t){this.table_sn=t.title,this.onToggleStatus("tableShow")},onSubmit:function(){var t=this;if(console.log(this.pay_type),this.total<=0)return this.$toast("消费总额不能为空"),!1;var s={sid:this.sid,total_fee:this.total,no_discount_part:this.nodiscount,couponId:this.couponId,table_sn:this.table_sn,note:this.note};this.util.request({url:"wmall/store/paybill/index",data:s}).then(function(s){var o=s.data.message;if(o.errno)return t.util.$toast(o.message,"",1e3),!1;var i=o.message;t.$router.replace(t.util.getUrl({path:"/pages/public/pay?order_id="+i+"&order_type=paybill"}))})}},created:function(){this.query=this.$route.query,this.query&&(this.sid=this.query.sid)},mounted:function(){this.onLoad()}},l={render:function(){var t=this,s=t.$createElement,o=t._self._c||s;return o("div",{attrs:{id:"store-paybill"}},[o("public-header",{attrs:{title:t.store.title}}),t._v(" "),o("div",{staticClass:"content"},[o("div",{staticClass:"list-block"},[o("ul",[o("li",[o("div",{staticClass:"item-content"},[o("div",{staticClass:"item-inner"},[o("div",{staticClass:"item-title"},[t._v("消费总额("+t._s(t.Lang.dollarSignCn)+")")]),t._v(" "),o("div",{staticClass:"item-input"},[o("input",{staticClass:"align-right",attrs:{type:"number",placeholder:"询问服务员后输入","data-type":"total"},on:{input:t.onInput}})])])])]),t._v(" "),o("li",[o("div",{staticClass:"check",on:{click:function(s){return t.onToggleStatus("noDiscountShow")}}},[o("div",{staticClass:"checked",class:{checked:t.status.noDiscountShow,active:t.status.noDiscountShow}},[o("van-icon",{attrs:{name:t.status.noDiscountShow?"check":""}})],1),t._v("\n\t\t\t\t\t\t输入不参与优惠金额(如酒水、套餐)\n\t\t\t\t\t")])]),t._v(" "),t.status.noDiscountShow?o("li",[o("div",{staticClass:"item-content"},[o("div",{staticClass:"item-inner"},[o("div",{staticClass:"item-title"},[t._v("不参与优惠金额")]),t._v(" "),o("div",{staticClass:"item-input"},[o("input",{staticClass:"align-right",attrs:{type:"text",placeholder:"询问服务员后输入","data-type":"nodiscount"},on:{input:t.onInput}})])])])]):t._e()])]),t._v(" "),"1"==t.paybill_extra?[o("van-cell-group",[o("van-cell",{attrs:{title:"包厢/桌号","arrow-direction":"down"},on:{click:function(s){return t.onToggleStatus("tableShow")}}},[o("div",{staticClass:"flex c-gray",attrs:{slot:"right-icon"},slot:"right-icon"},[t.table_sn?o("span",[t._v(t._s(t.table_sn))]):o("span",[t._v("请选择桌号")]),t._v(" "),o("van-icon",{staticClass:"margin-5-l",attrs:{name:"arrow-down"}})],1)])],1),t._v(" "),o("van-cell-group",{staticClass:"margin-10-t"},[o("van-field",{attrs:{type:"textarea",placeholder:"请输入备注，最多50字哦"},model:{value:t.note,callback:function(s){t.note=s},expression:"note"}})],1)]:t._e(),t._v(" "),o("div",{staticClass:"list-block"},[o("van-cell-group",[o("van-cell",{attrs:{"is-link":""},on:{click:function(s){return t.onToggleStatus("couponShow")}}},[o("div",{staticClass:"van-cell__value"},[o("span",{class:{"c-danger":t.couponId>0}},[t._v(t._s(t.couponTitle))])]),t._v(" "),o("template",{slot:"title"},[o("span",{staticClass:"van-cell-text"},[t._v("优惠券")]),t._v(" "),t.couponNum>0?o("van-tag",{attrs:{type:"danger"}},[t._v(t._s(t.couponNum)+"张可用")]):t._e()],1)],2),t._v(" "),o("van-cell",{attrs:{title:"实付金额",value:t.final}})],1)],1),t._v(" "),t._e(),t._v(" "),o("div",{staticClass:"list-block"},[o("div",{staticClass:"confirm"},[t.total>0&&t.total>t.nodiscount?o("div",{staticClass:"submit",on:{click:t.onSubmit}},[t._v("确认买单")]):o("div",{staticClass:"submit disabled"},[t._v("确认买单")])])])],2),t._v(" "),t.showPreLoading?o("iloading"):t._e(),t._v(" "),t.coupons.length>0?o("van-popup",{attrs:{position:"bottom"},model:{value:t.status.couponShow,callback:function(s){t.$set(t.status,"couponShow",s)},expression:"status.couponShow"}},[o("div",{staticClass:"popup-coupon"},[o("div",{staticClass:"popup-title van-hairline--bottom"},[t._v("商家代金券")]),t._v(" "),o("div",{staticClass:"popup-container"},[o("load",{attrs:{type:"loaded",text:"可用代金券("+t.coupons.length+"张)",bgcolor:"#f5f5f5"}}),t._v(" "),o("div",{staticClass:"coupon-list"},[o("div",{staticClass:"content-padded"},t._l(t.coupons,function(s,i){return o("div",{staticClass:"coupon-item"},[o("div",{staticClass:"clearfix",on:{click:function(o){return t.onSelectCoupon(i,s.id)}}},[o("span",{staticClass:"circle circle-left"}),t._v(" "),o("span",{staticClass:"circle circle-right"}),t._v(" "),o("div",{staticClass:"left"},[o("div",{staticClass:"store-logo"},[o("img",{attrs:{src:s.logo,alt:""}})]),t._v(" "),o("div",{staticClass:"coupon-detail"},[o("div",{staticClass:"coupon-title"},[t._v(t._s(s.title))]),t._v(" "),o("div",{staticClass:"use-time"},[t._v("有效期至:"+t._s(s.endtime_cn))])])]),t._v(" "),o("div",{staticClass:"right"},[o("div",{staticClass:"price"},[o("span",[t._v(t._s(t.Lang.dollarSign))]),t._v(t._s(s.discount)+"\n\t\t\t\t\t\t\t\t\t")]),t._v(" "),o("div",{staticClass:"condition"},[t._v("满"+t._s(s.condition)+t._s(t.Lang.dollarSignCn)+"可用")])])]),t._v(" "),t.couponId==s.id?o("div",{staticClass:"selected-status"},[o("img",{attrs:{src:"static/img/success.png",alt:""}})]):t._e()])}),0)])],1),t._v(" "),o("div",{staticClass:"popup-cancle van-hairline--top",on:{click:function(s){return t.onSelectCoupon(-1,0)}}},[t._v("不使用代金券")])])]):t._e(),t._v(" "),o("van-popup",{attrs:{position:"bottom"},model:{value:t.status.tableShow,callback:function(s){t.$set(t.status,"tableShow",s)},expression:"status.tableShow"}},[o("van-picker",{attrs:{"show-toolbar":"",title:"请选择桌号",columns:t.tables,"value-key":"title"},on:{cancel:function(s){return t.onToggleStatus("tableShow")},confirm:t.onTableConfirm}})],1)],1)},staticRenderFns:[]};var u=o("VU/8")(c,l,!1,function(t){o("ocsE")},null,null);s.default=u.exports},ocsE:function(t,s){}});
//# sourceMappingURL=33.05e6b48704c1195019ab.js.map